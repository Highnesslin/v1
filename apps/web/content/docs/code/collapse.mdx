---
title: Collapse
description: Collapse annotation example
layout: PreviewAndImplementation
---

## !demo

Fold and unfold blocks of code.

<Demo name="collapse">
  Click on the function signature to collapse/expand the content of the function
</Demo>

## !implementation

We use the `Collapsible` component from [shadcn/ui](https://ui.shadcn.com/docs/components/collapsible):

```bash
npx shadcn-ui@latest add collapsible
```

So, for each `!Collapse` annotation we need two add to extra annotations, one for the trigger and one for the content.

<CodeWithNotes>

```tsx ! code.tsx
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible"

const Code: CodeComponent = async ({ codeblock }) => {
  const highlighted = await highlight(codeblock, "github-dark")

  // !Tooltip[41:51] annotations
  highlighted.annotations = highlighted.annotations.flatMap((annotation) => {
    if (annotation.name !== "Collapse") {
      return annotation
    }
    const { fromLineNumber } = annotation as BlockAnnotation
    return [
      annotation,
      {
        ...annotation,
        fromLineNumber: fromLineNumber,
        toLineNumber: fromLineNumber,
        name: "CollapseTrigger",
      },
      {
        ...annotation,
        fromLineNumber: fromLineNumber + 1,
        name: "CollapseContent",
      },
    ]
  })

  return (
    <Pre
      className="m-0 px-0"
      code={highlighted}
      components={{
        BlockCollapse,
        BlockCollapseContent: CollapsibleContent,
        LineCollapseTrigger,
        Line,
      }}
    />
  )
}

function BlockCollapse({
  annotation,
  children,
}: {
  annotation: any
  children: React.ReactNode
}) {
  return (
    <Collapsible defaultOpen={annotation.query !== "collapsed"}>
      {children}
    </Collapsible>
  )
}

function LineCollapseTrigger({ annotation, ...props }: any) {
  const icon = (
    <ChevronDownIcon
      className="inline-block group-data-[state=closed]:-rotate-90 transition select-none opacity-30 group-data-[state=closed]:opacity-80 group-hover:!opacity-100 mb-0.5"
      size={15}
    />
  )
  return (
    <CollapsibleTrigger className="group">
      <Line {...props} icon={icon} />
    </CollapsibleTrigger>
  )
}

function Line({
  children,
  lineNumber,
  icon,
}: {
  children: React.ReactNode
  lineNumber: number
  icon?: React.ReactNode
}) {
  return (
    <div data-line={lineNumber}>
      <span className="w-6 text-center inline-block">{icon}</span>
      {children}
    </div>
  )
}
```

#### !!notes collapsible

There are three parts to the `Collapsible` component:

- `CollapsibleTrigger` in our case is the top line that is clicked to fold/unfold the content
- `CollapsibleContent` is the rest of the lines that are folded/unfolded
- `Collapsible` wraps the trigger and content

#### !!notes annotations

```json
[
  {
    "name": "Collapse",
    "query": "",
    "fromLineNumber": 1,
    "toLineNumber": 4
  },
  {
    "name": "Collapse",
    "query": "collapsed",
    "fromLineNumber": 7,
    "toLineNumber": 10
  }
]
```

</CodeWithNotes>
